/**
 * jquery-layer
 * Copyright (c) 2012 shepik@gmail.com
 * based on jmpopups
 * Copyright (c) 2009 Otavio Avila (http://otavioavila.com)
 * Licensed under GNU Lesser General Public License
 * @docs http://jmpopups.googlecode.com/
 * @version 0.5.1
 * 
 */

function FlowCollection(t){for(var e=0;t[e];e++)this[e]=t[e]}function Flow(t,e){this.inputs={},this.data={},this.outputs={},this.cb=t,this.name=e||Flow.getUid(),this.state=0,this.result=null}function flowPaused(t){var e=new Flow(function(t){return e.resumed?t(e.resume_data):void(e.resume=function(e){t(e)})},t);return e.resumed=!1,e.resume=function(t){e.resume_data=t,e.resumed=!0},e}function flow(t,e){if(t instanceof Flow)return t;var o=new Flow(t,e);return o}function syncflow(t,e){return flow(function(e,o,n){e(t(o,n))},e)}function nb_write(t){document.write(nb_get(t))}function nb_get(t){return Base64.decode(t.split("=").join("\0").split("A").join("=").split("\0").join("A"))}function capitalize(t){var e=t.toString();return e[0].toUpperCase()+e.slice(1)}function goortb(t,e,o,n,i,a){if(!goortb.script){goortb.script=!0;var r=document.getElementsByTagName("script")[0],s=document.createElement("script");s.type="text/javascript",s.src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",s.async=!0,r.parentNode.insertBefore(s,r)}goortb[e]=goortb[e]?goortb[e]:0;var l=i[goortb[e]],c=[].concat(o),u=[].concat(n),d=c[goortb[e]]||o,h=u[goortb[e]]||n;goortb[e]++;var p=3,f=function(e){var o='<ins class="adsbygoogle" style="display:inline-block;width:'+d+"px;height:"+h+'px"';o=o+' data-ad-client="ca-pub-6077965237125445" data-ad-slot="'+l+'"></ins>',document.getElementById(t).innerHTML=o,(window.adsbygoogle=window.adsbygoogle||[]).push({}),p&&(p--,rtb_refresh(t,function(){f()},a))};f()}function yartb(t,e,o,n,i){var a=function(){"undefined"==typeof n?($("#"+t).closest(".js-parent").parent().remove(),$(window).trigger("height")):require(["js2/nobot/decode"],function(){$("#"+t).closest(".js-parent").parent().replaceWith(nb_get(n)),$(window).trigger("height")}),a=function(){}};!function(n,r,s,l,c){yartb[e]=yartb[e]?yartb[e]:0;var u=o[yartb[e]];if(yartb[e]++,!u)return void jquery(function(){a()});var d=3,h=function(){Ya.Context.AdvManager.render({blockId:u,renderTo:t,async:!0,onRender:function(){jquery(function(){$(document.getElementById(t)).closest(".js-parent").css("height","").parent().css("visibility",""),$(window).trigger("height"),d&&(d--,rtb_refresh(t,function(){h()},i))})}},function(){jquery(function(){a()})})};n[s]=n[s]||[],n[s].push(h),c=r.getElementsByTagName("script")[0],l=r.createElement("script"),l.type="text/javascript",l.src="//an.yandex.ru/system/context.js",l.async=!0,c.parentNode.insertBefore(l,c)}(window,window.document,"yandexContextAsyncCallbacks"),jqready(function(){setTimeout(function(){var e=$("#"+t);e.height()||a()},5e3)})}function rtb_refresh(t,e,o){o&&jquery(function(){var n=$(document.getElementById(t)),i=n.outerHeight(),a=0,r=!1,s=setInterval(function(){var t=$(window).scrollTop(),l=n.offset().top;t-i/2<=l&&t+$(window).height()-i/2>=l&&(r=!0),r&&a++,a>o&&(clearInterval(s),e&&e())},1e3)})}function replaceWindowHash(t){var e=window.location.href.replace(/#(.*)$/,"");e+t!=window.location.href&&(""==t&&e+"#"==window.location.href||(""==t&&""!=window.location.href&&(t="#"),"replaceState"in history?history.replaceState("",document.title,e+t):(scrollV=document.body.scrollTop,scrollH=document.body.scrollLeft,window.location.replace(e+t),document.body.scrollTop=scrollV,document.body.scrollLeft=scrollH)))}function plural(t,e,o,n){if((t%=100)&&(t<11||t>19)&&(t%=10)){if(1===t)return o;if(t<5)return n}return e}define("js2/Observable",["underscore"],function(t){var e=function(){this.initObservable()};return e.prototype.initObservable=function(){this.__events={}},e.prototype.on=function(t,e){t=t.split(" ");for(var o in t){var n=t[o];this.__events[n]||(this.__events[n]=[]),this.__events[n].push(e)}return this},e.prototype.one=function(t,e){var o=this,n=function(i){e.apply(this,Array.prototype.slice.call(arguments,0)),o.off(t,n)};o.on(t,n)},e.prototype.off=function(e,o){e=e.split(" ");for(var n in e){var i=e[n];this.__events[i]&&(o?this.__events[i]=t.filter(this.__events[i],function(t){return t!=o}):this.__events[i]=[])}return this},e.prototype.trigger=function(e,o){if(!this.__events[e])return this;var n=this,i=Array.prototype.slice.call(arguments,1);t.each(this.__events[e],function(t){return t.apply(n,i),this})},e}),define("js2/env",[],function(){"use strict";var t={is_mobile:!!window.is_mobile,is_ipad:!!window.is_ipad,is_android:!!window.is_android,is_phone:!!window.is_phone,fixed_layout:null,list_scroll:null,filters_scroll:null};return t.is_ipad&&(t.fixed_layout=!0,t.list_scroll="native",t.filters_scroll="native"),t}),FlowCollection.prototype=new Array,FlowCollection.prototype.get=function(t){for(var e=0;this[e];e++)if(t in this[e].data)return this[e].data[t];return null},Flow._uid=0,Flow.getUid=function(){return++Flow._uid},Flow.debug=0,Flow.prototype.execute=function(t){if(0!=this.state)return!1;this.state=1,this.data.args=arguments;var e=this;return setTimeout(function(){e._execute(e.data.args)},0),!0},Flow.prototype.execute_now=function(t){return 0==this.state&&(this.state=1,this.data.args=arguments,void this._execute(t))},Flow.prototype._execute=function(t){if(!_.every(this.inputs,function(t){return 3==t.state}))return void _.each(this.inputs,function(t){0==t.state&&t.execute_now()});if(1!=this.state&&0!=this.state)return!1;this.state=2,Flow.debug&&console.log("_execute",this.name);var e=this,o=function(t){Flow.debug&&console.log("next",e.name),e.result=t,e.state=3,_.each(e.outputs,function(o){o.data[e.name]=t,o._execute(t)}),e.inputs={},e.data={},e.outputs={}};this.cb(o,_.size(this.inputs)<=1?t:null,this.data)},Flow.prototype.andthen=function(t,e){return t instanceof Flow?(Flow.debug&&console.log(this.name+" -> "+t.name),t.inputs[this.name]=this,this.outputs[t.name]=t,t):this.andthen(new Flow(t,e))},Flow.decorateMap=function(t){var e={};return _.each(t,function(t,o){t instanceof Flow&&"number"==typeof t.name?(t.name=o,e[o]=t):"function"==typeof t?e[o]=new Flow(t,o):e[o]=t}),e},define("js2/flow",function(){}),define("js2/ZMap3",["./Observable","jquery","underscore","./env","js2/flow"],function(t,e,o,n){function i(t){n.is_mobile||require(["js2/mousewheelLimited"],t)}function a(t){var e={cx:0,cy:0,r:0};o.extend(e,t);var n='<circle cx="'+e.cx+'" cy="'+e.cy+'" r="'+e.r+'"';return n+=e.color?' fill="'+e.color+'"':"",n+=e.class?' class="'+e.class+'"':"",n+=" />"}function r(t){var e=[.6,.3],n={cx:0,cy:0,r:0,r_bottom:0};o.extend(n,t);var i=n.r*e[0],a=n.r*e[1],r="<path ";return r+='d="M'+(n.cx-n.r)+" "+n.cy,r+=" A "+n.r+" "+n.r+", 0, 0, 1, "+(n.cx+n.r)+" "+n.cy,r+=" C"+(n.cx+n.r)+" "+(n.cy+i)+","+(n.cx+a)+" "+(n.cy+n.r_bottom)+","+n.cx+" "+(n.cy+n.r_bottom),r+=" C"+(n.cx-a)+" "+(n.cy+n.r_bottom)+","+(n.cx-n.r)+" "+(n.cy+i)+","+ +(n.cx-n.r)+" "+n.cy,r+=' Z"',r+=' fill="'+n.color+'"',r+=n.class?' class="'+n.class+'"':"",r+=" />"}function s(t){var e=t(window);e.on("z-location-set",function(o,n,i,a){window.Global.user.has_coords=!0,window.Global.user.lat=n[0],window.Global.user.lon=n[1],t.post("/js.php",{area:"profile",action:"location",lat:n[0],lon:n[1]},function(){i&&i(!0),e.trigger("z-location-changed",[a])})}),e.on("z-location-auto",function(t,o,n){return"undefined"==typeof navigator.geolocation?(window.Global.user.has_coords=!0,e.trigger("z-location-manual"),void(n&&n(!1))):void navigator.geolocation.getCurrentPosition(function(t){var i=10;t.coords.accuracy<125e3&&(i=11),t.coords.accuracy<3e4&&(i=12),t.coords.accuracy<3e3&&(i=15,o&&e.trigger("z-location-balloon-close",o)),e.trigger("z-location-set",[[t.coords.latitude,t.coords.longitude],n,i])},function(){n&&n(!1)},{enableHighAccuracy:!0,timeout:3e3,maximumAge:0})}),e.on("z-location-manual",function(){})}var l=n.is_mobile?32:24,c={default:{center_on_user:!1,center_on_items:!1,center_on_items_and_user:!1,balloon:!0,balloon_gallery:!0,balloon_loader:!1,controls:function(t){},placemark_user:!0,paused:!0,feedback:!1,postpone_map_creation:!1,bounds_adjustment_mode:"default",clusterer:!1,balloonAutoPanMargins:[0,0,0,0]},index:{center_on_user:!0,center_on_items:!0,map_url:"js.php?area=catalog&action=map",paused:!0,bounds_adjustment_mode:"flexible",balloonAutoPanMargins:[34,34,34,34],balloonLayout:"z#zoon_balloon_template"},catalog:{center_on_items_and_user:!1,bounds_adjustment_mode:"precise",balloon:!0,balloon_loader:!0,feedback:!n.is_mobile,paused:!0,center_on_user:!1,center_on_items:!0,clusterer:!0,onBalloonOpen:function(t){this.trigger("balloon_open",t)},balloonAutoPanMargins:[90,34,34,654],balloonMaxHeight:9999,balloonLayout:"z#zoon_balloon_template"},masterprice:{center_on_items_and_user:!1,bounds_adjustment_mode:"precise",balloon:!0,balloon_gallery:!1,balloon_loader:!0,feedback:!n.is_mobile,paused:!0,center_on_user:!1,center_on_items:!0,clusterer:!0,onBalloonOpen:function(t){this.trigger("balloon_open",t)},balloonAutoPanMargins:[20,20,20,20],balloonMaxHeight:9999,balloonLayout:"z#zoon_balloon_template"},network:{center_on_items:!0,feedback:!n.is_mobile,clusterer:!0,controls:function(){this.addControls(["zoomControl"])}},service:{center_on_items:!0,balloon:!1,bounds_adjustment_mode:"precise",onPlacemarkClick:function(t){this.trigger("point_click",t)}},layer:{center_on_items:!0,balloon:!1,controls:function(){this.addControls(["zoomControl"])},onPlacemarkClick:function(t){this.trigger("point_click",t)}},layer_new:{center_on_items_and_user:!0,feedback:!n.is_mobile,balloon:!0,controls:function(){this.addControls(["zoomControl"])},balloonAutoPanMargins:[20,20,20,20],onPlacemarkClick:function(t){this.trigger("point_click",t)},balloonLayout:"z#zoon_balloon_template"},lego_network:{center_on_items:!0,feedback:!n.is_mobile,balloon:!1,controls:function(){this.addControls(["zoomControl"])},onPlacemarkClick:function(t){this.trigger("point_click",t)}},my_location:{center_on_user:!0,balloon:!1,controls:function(){this.addControls(["zoomControl"])},placemark_user:!1},platform:{center_on_items:!0,feedback:!n.is_mobile,controls:function(){this.addControls(["zoomControl"])}},prof:{center_on_items:!0,feedback:!n.is_mobile,balloon:!1,controls:function(){this.addControls(["zoomControl"])},onPlacemarkClick:function(t){this.trigger("point_click",t)}},landing:{center_on_items:!0,balloon:!1,controls:function(){this.addControls(["zoomControl"])}}},u=function(a,r,s){var l=this;this.nodeSelector=a,this.params=s||{},this.mwLimitedNodeSelector=this.params.mwLimitedNodeSelector||this.nodeSelector,o.extend(this,new t),this.pushOnReady=function(t){this.is_ready?t():this.one("z-loaded",t)},this.query={},this.map=null,this.is_ready=!1,this.options=o.extend({},c.default,"string"==typeof r?c[r]:r),this.options.onPlacemarkClick&&(this.onPlacemarkClick=this.options.onPlacemarkClick),this.options.onBalloonOpen&&(this.onBalloonOpen=this.options.onBalloonOpen),this.placemarks={},this.placemark_clicked=null,this.profilePlacemark=null,this.onShowHook=function(){},this.onBalloon_binded=function(t){return l.onBalloon(t)},this.onBalloon_close=function(t){return l.onBalloonClose(t)},this.onHighlight=function(t){var e=l.getData(t,"target"),o=l.getData(t,"type")==l.events.mouseenter,n=l.getPlacemarkData(e,"itemData");l.getBalloon(e)&&l.isBalloonOpen(l.getBalloon(e))||(l.highlightItem(n.id,o),l.trigger("z-highlight",n.id,o))},this.getNode=function(){return l.node||e(l.nodeSelector)},this.getMwLimitedNode=function(){return l.mwLimitedNode||e(l.mwLimitedNodeSelector)},this.wheelEnabled=null,this.wheelHard=!1,this.toggleWheel=function(t,e){l.map&&l.wheelEnabled!==t&&(!e&&l.wheelHard||(t?l.behaviorsEnabled("scrollZoom"):l.behaviorsDisabled("scrollZoom"),l.wheelEnabled=t,l.wheelHard=!!e))},this.wheelToScale=function(t){l.toggleWheel(!0,t),l.$zoom&&i(function(){l.$zoom.mousewheelPrevent()})},this.wheelToScroll=function(t){l.toggleWheel(!1,t),l.$zoom&&i(function(){l.$zoom.unmousewheelPrevent()})};var d=Flow.decorateMap({api:function(t){return l.isInitialized()?t():void l.loadMaps(function(){l.initialize(),t()})},jq:flowPaused(),map:syncflow(function(t,e){var o=e.resume;"function"==typeof o&&(o=o()),l.createMap(o),l.is_ready=!0,l.trigger("z-loaded")}),resume:function(t){l.resume=function(e){l.options.paused=!1,t(e)}},dummy:null});d.api.andthen(d.map),d.jq.andthen(d.map),l.flows=d,d.resume.andthen(d.map).execute_now(),l.getStatic=u,jquery(function(){l.node=l.getNode(),l.mwLimitedNode=l.getMwLimitedNode(),d.jq.resume()}),this.removePlacemark=function(t){this.placemarks[t]&&(this.options.clusterer&&l.removeCluster([this.placemarks[t]]),delete this.placemarks[t])},this.translateCenter=function(t,e){return t},l.pushOnReady(function(){var t=l.map;l.addEvents(t,"click",function(o){var i=l.getData(o,"target");n.is_phone&&i===t&&e("#ymaps-balloon").empty(),l.current_balloon&&(l.balloonClose(l.current_balloon),l.current_balloon=null)}),l.addEvents(t,"mousedown",function(t){l.wheelToScale()}),l.mwLimitedNode.data("waitingForEnter",!1).on("mouseleave",function(){e(this).data("waitingForEnter",l.wheelEnabled),l.wheelToScroll()}),e("html,body").on(l.events.mouseenter,function(t){var o=e(t.target);o.is("ymaps")&&l.mwLimitedNode.data("waitingForEnter")&&l.wheelToScale(),l.mwLimitedNode.data("waitingForEnter",!1)}),l.addEvents(t,"actionbegin",function(t){l.bounds_change_blocks||l.trigger("z-user-interact-begin",t)}),l.on("z-placemark-click z-cluster-click",function(t){l.trigger("z-user-interact-begin",t)})})};u.getStyle=function(t,e){return o.extend({},c[t],e||{})},u.utilGetCenterAndZoomDir=function(t,e,o){var n,i=o.dir||-1,a=o.offsetLeft||0;if(!t&&window.Global.city_location)return{center:[window.Global.city_location[1],window.Global.city_location[0]],zoom:12};t.center?n=t:(4===t.length&&(t=[[t[1],t[0]],[t[3],t[2]]]),n=this.utilGetCenterAndZoom(t,e));var r=this.toPixelsMercator(n.center,n.zoom);r[0]+=i*a/2;var s=this.fromPixelsMercator(r,n.zoom);return{center:s,zoom:n.zoom}},u.prototype.getIconPlacemarkSVG=function(t){var e={radius:0,fontSize:"0px",r:[0,0,0,0],color:"#fff"};o.extend(e,t);var n='<svg width="'+2*e.radius+'" height="'+2*e.radius+'">';return n+=a({cx:e.radius,cy:e.radius,r:e.r[0],color:"#fff"}),n+=a({cx:e.radius,cy:e.radius,r:e.r[1],color:e.color,class:"svg-marker-color"}),n+=a({cx:e.radius,cy:e.radius,r:e.r[2],color:"#fff"}),n+=a({cx:e.radius,cy:e.radius,r:e.r[3],color:e.color,class:"svg-marker-color"}),n+="</svg>"},u.prototype.getSingleIconPlacemarkSVG=function(t){var e={radius:0,fontSize:"0px",r:[0,0,0,0],color:"#fff",bottom_stretch_k:0};o.extend(e,t);var n=e.radius*e.bottom_stretch_k,i='<svg  width="'+2*e.radius+'" height="'+(2*e.radius+n)+'">';return i+=r({cx:e.radius,cy:e.radius,r:e.r[0],color:"#fff",r_bottom:e.r[0]+n}),i+=r({cx:e.radius,cy:e.radius,r:e.r[1],color:e.color,class:"svg-marker-color",r_bottom:e.r[1]+n}),i+=a({cx:e.radius,cy:e.radius,r:e.r[2],color:"#fff"}),i+=a({cx:e.radius,cy:e.radius,r:e.r[3],color:e.color,class:"svg-marker-color"}),i+="</svg>"};var d='<svg width="{{ options.clusterIcons[0].size[0] }}" height="{{ options.clusterIcons[0].size[1] }}"><circle cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[0] }}" fill="#ffffff" /><circle class="svg-marker-color" cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[1] }}" fill="{{ options.clusterIcons[0].color }}" /><circle cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[2] }}" fill="#ffffff" /><circle class="svg-marker-color" cx="{{ options.clusterIcons[0].radius }}" cy="{{ options.clusterIcons[0].radius }}" r="{{ options.clusterIcons[0].r[3] }}" fill="{{ options.clusterIcons[0].color }}" />{% if properties.geoObjects.length %}<text transform="translate(0, 1)" text-anchor="middle" dy=".5ex" x="{{ options.clusterIcons[0].radius }}" y="{{ options.clusterIcons[0].radius }}" style="font-family: Arial; font-size: {{ options.clusterIcons[0].fontSize }}; font-weight: bold; fill: {{ options.clusterIcons[0].color }};">{% if properties.geoObjects.length < 100 %}{{ properties.geoObjects.length }}{% else %}99+{% endif %}</text>{% endif %}</svg>';u.prototype.loadMaps=function(t){window.nbl_ymaps2_loaded?t():window.nbl_ymaps2_onload_cbs?window.nbl_ymaps2_onload_cbs.push(t):(window.nbl_ymaps2_loaded=!1,window.nbl_ymaps2_onload_cbs=[t],window.nbl_ymaps2_onload=function(){window.nbl_ymaps2_loaded=!0,o.each(window.nbl_ymaps2_onload_cbs,function(t){t()}),window.nbl_ymaps2_onload_cbs=null},requirejs.config({paths:{ymaps:"//api-maps.yandex.ru/2.1/?lang=ru-RU&onload=nbl_ymaps2_onload"},shim:{ymaps:{exports:"ymaps"}}}),require(["ymaps"],function(){},function(){window.navigator.userAgent.toLowerCase().indexOf("firefox")!=-1&&e.post("/js.php",{area:"misc",action:"firefoxProtection"})}))},u.prototype.initialize=function(){var t=this;if(!this.isInitialized()){this.setInitialized();var i={radius:17,fontSize:"11px",r:[17,15,11,5],size:[34,34],offset:[-17,-17],color:"#694caf",bottom_stretch_k:.88};n.is_phone&&o.extend(i,{radius:12.5,fontSize:"8px",r:[12.5,11,8,3.5],size:[25,25],offset:[-12.5,-12.5]}),this.initPresetStorage(i),this.initTemplateStorage(),e(window).on("z-location-balloon-close",function(e){t.balloonClose(e)})}},u.prototype.setInitialized=function(){u.initialized=!0},u.prototype.isInitialized=function(){return u.initialized},u.prototype.initPresetStorage=function(t){var e=this,n=o.clone(t.r);n[n.length-1]=0;var i=o.extend({},t,{r:n}),a=function(t){return{iconLayout:ymaps.templateLayoutFactory.createClass(e.getIconPlacemarkSVG(t)),iconShape:{type:"Circle",coordinates:[t.radius,t.radius],radius:t.radius},iconSize:[2*t.radius,2*t.radius],zIndex:2,zIndexActive:3,iconOffset:[-t.radius,-t.radius]}},r=function(t){return{iconLayout:ymaps.templateLayoutFactory.createClass(e.getSingleIconPlacemarkSVG(t)),iconShape:{type:"Rectangle",coordinates:[[0,0],[2*t.radius,t.radius*(2+t.bottom_stretch_k)]]},iconSize:[2*t.radius,(2+t.bottom_stretch_k)*t.radius],zIndex:2,zIndexActive:3,iconOffset:[-t.radius,-t.radius*(2+t.bottom_stretch_k)]}};ymaps.option.presetStorage.add("z#cluster",[i]),ymaps.option.presetStorage.add("z#cluster-hover",[o.extend({},i,{color:"#fa4077"})]),ymaps.option.presetStorage.add("z#cluster-dot",[o.extend({},i,{color:"#fa4077",r:[7,5,0,0]})]),ymaps.option.presetStorage.add("z#cluster-dot-hover",[o.extend({},i,{color:"#fa4077"})]),ymaps.option.presetStorage.add("z#marker",a(t)),ymaps.option.presetStorage.add("z#marker-hover",a(o.extend({},t,{color:"#fa4077"}))),ymaps.option.presetStorage.add("z#dot",a(o.extend({},t,{color:"#fa4077",r:[7,5,0,0]}))),ymaps.option.presetStorage.add("z#dot-hover",a(o.extend({},t,{iconColor:"#fa4077"}))),ymaps.option.presetStorage.add("z#singlemarker",r(t)),ymaps.option.presetStorage.add("z#singlemarker-hover",r(o.extend({},t,{color:"#fa4077"}))),ymaps.option.presetStorage.add("z#singlemarker-dot",a(o.extend({},t,{color:"#fa4077",r:[7,5,0,0]}))),ymaps.option.presetStorage.add("z#singlemarker-dot-hover",a(o.extend({},t,{iconColor:"#fa4077"}))),ymaps.option.presetStorage.add("z#profile",{iconLayout:"default#image",zIndex:651,zIndexActive:651,iconImageHref:"/images/map_profile.png?v=2",iconImageSize:[17,48],iconImageOffset:[-9,-47],hideIconOnBalloonOpen:!1}),ymaps.option.presetStorage.add("z#profile-hover",{iconLayout:"default#image",zIndex:651,zIndexActive:651,iconImageHref:"/images/map_profile.png?v=2",iconImageSize:[17,48],iconImageOffset:[-9,-47],hideIconOnBalloonOpen:!1}),ymaps.layout.storage.add("z#placemark",ymaps.templateLayoutFactory.createClass("{{options.contentBodyLayout}}"))},u.prototype.initTemplateStorage=function(){var t=ymaps.templateLayoutFactory.createClass('<div class="balloon-layout"><span class="balloon-layout-close cursor"><span class="s-icons-input-reset-big"></span></span><div class="balloon-layout-arrow s-icons-map-balloon-arrow"></div><div class="balloon-layout-inner">$[[options.contentLayout observeSize]]</div></div>',{build:function(){this.constructor.superclass.build.call(this),this._$element=e(".balloon-layout",this.getParentElement()),this.applyElementOffset(),this._$element.find(".balloon-layout-close").on("click",e.proxy(this.onCloseClick,this))},onCloseClick:function(t){t.preventDefault(),t.stopPropagation(),this.events.fire("userclose")},onSublayoutSizeChange:function(){t.superclass.onSublayoutSizeChange.apply(this,arguments),this._isElement(this._$element)&&(this.applyElementOffset(),this.events.fire("shapechange"))},clear:function(){this._$element.find(".balloon-layout-close").off("click"),this.constructor.superclass.clear.call(this)},applyElementOffset:function(){this._$element.css({left:-(this._$element[0].offsetWidth/2)})},getShape:function(){if(!this._isElement(this._$element))return t.superclass.getShape.call(this);var o=this._$element.position(),n=this._$element[0],i=e(n).find(".balloon-layout-inner"),a=i.find("> ymaps"),r=o.left,s=o.top,l=Math.max(n.offsetWidth,i.outerWidth(),a.outerWidth()),c=Math.max(n.offsetHeight,i.outerHeight(),a.outerHeight());return c+=this._$element.find(".balloon-layout-arrow")[0].offsetHeight-8,i.length&&a.length&&(r+=i.outerWidth()-a.outerWidth(),s+=i.outerHeight()-a.outerHeight()),new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[r,s],[r+l,s+c]]))},_isElement:function(t){return t&&t[0]&&t.find(".balloon-layout-arrow")[0]}});ymaps.layout.storage.add("z#zoon_balloon_template",t)};var h=function(t,e){for(var o,n=t.length,i=0,a=t[0],r=1;r<=n;r++){var s=t[r%n];e[1]>Math.min(a[1],s[1])&&e[1]<=Math.max(a[1],s[1])&&e[0]<=Math.max(a[0],s[0])&&a[1]!=s[1]&&(o=(e[1]-a[1])*(s[0]-a[0])/(s[1]-a[1])+a[0],(a[0]==s[0]||e[0]<=o)&&i++),a=s}return i%2==1};u.prototype.activationBalloon=function(t){var o=this;if(o.source_multiballoon){var n=o.getBalloonContent(t).replace("map-tooltip-back-hide","");o.setBalloonContent(t,n)}var i=e(o.getBalloonElement(o.getBalloon(t))),a=i.find(".balloon-gallery");i.on("click",".js-back",function(t){t.preventDefault(),t.stopPropagation(),o.set_scroll_position=!0,o.showClusterBalloon(o.source_multiballoon)}),i.on("click",".js-favorite",function(t){t.preventDefault();var o=e(this);if(o.hasClass("js-favorite-blocked"))return void create_layer("auth",{title:"Войдите, чтобы добавить в избранное",target_action:"to_favorite"});var n=o.data("id"),i=o.hasClass("active");e.post("/js.php",{area:"service",action:"favorite",id:n,value:+!i},function(t){t.success&&o[t.value?"addClass":"removeClass"]("active")})}),i.on("click",".js-tour3d",function(t){t.preventDefault(),create_layer("tour3d",{width:e(window).width(),offset:10,parameters:{org_id:e(this).data("id")}})}),a.length&&require(["js2/ServiceGallery2"],function(t){new t(a)})},u.prototype.activationCluster=function(t,o){var n=this,i=e(n.getBalloonElement(n.getBalloon(o))),a=i.find(".multiballoon-item-link"),r=i.find(".multiballoon-scroll-wrapper"),s=r.find(".multiballoon-scroll-block"),l=i.find(".multiballoon-header");lazyload(s,{container:r}),n.set_scroll_position&&r.scrollTop(n.scroll_position),n.set_scroll_position=!1,n.scroll_position=0,r.off("scroll.activation").on("scroll.activation",function(){n.scroll_position=r.scrollTop(),n.scroll_position?l.addClass("multiballoon-header-shadow"):l.removeClass("multiballoon-header-shadow")}),a.off("click.activation").on("click.activation",function(o){if(e(o.target).closest(".js-cluster-stoppropagation").length)return!0;o.preventDefault(),o.stopPropagation();var a=i.find(".multiballoon").width(),r=i.find(".multiballoon").height(),s=e(this).data("id"),l=n.getCoordinates(t),c=function(){t.geometry.getPixelGeometry()||n.balloonClose(n.getBalloon(d))},u={balloonAutoPan:!0,balloonAutoPanMargin:n.options.balloonAutoPanMargins,balloonMaxHeight:n.options.balloonMaxHeight};n.source_multiballoon=t;var d=n.createPlacemark(l,{itemData:{id:s}},u);n.options.balloonLayout&&n.setTemplateLayout(d,n.options.balloonLayout),n.addEvents(d,n.events.autopanbegin,function(){n.bounds_change_blocks++}),n.addEvents(d,n.events.autopanend,function(){n.bounds_change_blocks--}),n.setBalloonContent(d,'<div style="width:'+a+"px; height:"+r+'px;"></div>'),n.addEvents(d,n.events.balloonopen,n.onBalloon_binded),n.addEvents(d,n.events.balloonopen,function(t){n.setPlacemarkPreset(n.getData(t,"target"),"z#dot")}),n.addEvents(d,n.events.balloonclose,function(e){n.getData(e,"target");n.source_multiballoon=null,n.removeObjectFromMap(d),t.geometry.events.remove("optionschange",c),n.onBalloon_close(e)}),n.addObjectOnMap(d),n.balloonOpen(n.getBalloon(d),l),n.addEvents(t.geometry,"optionschange",c)})},u.prototype.matchPointsBySquare=function(t,e){var n=this,i=this.map.options.get("projection"),a=this.map.getZoom(),r=[];for(var s in this.placemarks){var l=this.placemarks[s];l&&r.push({id:s,global_px_coords:i.toGlobalPixels(n.getCoordinates(l),a)})}var c=[],u=i.toGlobalPixels(t,a),d=u[0],p=u[1],f=e;c.push([d-f,p-f],[d+f,p-f],[d+f,p+f],[d-f,p+f]);var m=[],n=this;return o.each(r,function(t){h(c,t.global_px_coords)&&m.push(n.getPlacemarkData(n.placemarks[t.id],"itemData").id)}),m},u.prototype.showClusterBalloon=function(t){var i=this.clusterer,a=this;if(this.current_balloon=a.getBalloon(i),o.isFunction(a.onBalloonOpen)&&a.onBalloonOpen(t),a.getBalloonContent(t))return void a.getBalloon(i).open(t).then(function(){a.activationCluster(t,i)});for(var r=t.getGeoObjects(),s=[],l=0;l<r.length;l++)s.push(a.getPlacemarkData(r[l],"itemData").id);a.balloonClose(a.getBalloon(i)),e.post("/js.php",{area:"service",action:"tooltip",service_ids:s},function(o){n.is_phone?e("#ymaps-balloon").html(o):(a.setBalloonContent(t,o),n.is_mobile||(t.options.set("balloonAutoPan",!0),t.options.set("balloonAutoPanMargin",a.options.balloonAutoPanMargins)),a.getBalloon(i).open(t).then(function(){a.activationCluster(t,i)}))})},u.prototype.switchCurrentBalloon=function(t){var e=this;this.current_balloon&&this.current_balloon!=t&&e.balloonClose(this.current_balloon),t&&(this.current_balloon=t)},u.prototype.onBalloonClose=function(t){if(this.current_balloon){var o=this,n=this.current_balloon,a=o.getOverlay(n),r=a?e(o.getBalloonElement(n)):null;r&&i(function(){r&&r.unmousewheelPrevent().data("wheelPrevented",!1)}),e(window).trigger("ymap-balloon-close",[n,r])}},u.prototype.onBalloon=function(t){this.preOnBalloonCallback&&this.preOnBalloonCallback(t);var a=this,r=a.getData(t,"target");o.isFunction(a.onBalloonOpen)&&a.onBalloonOpen(r),this.node.addClass("ymballooned");var s=a.getBalloon(r);this.switchCurrentBalloon(s);var l=a.getPlacemarkData(r,"itemData");if(i(function(){c.data("wheelPrevented")||c.mousewheelPrevent().data("wheelPrevented",!0)}),this.placemark_clicked=l.id,this.prev_highlighted&&a.fireEvent(this.placemarks[this.prev_highlighted],a.events.mouseleave),!n.is_phone){var c=e(a.getBalloonElement(s)),u=c.find(".balloon-layout-inner"),d=500,h=(""+a.getBalloonContent(r)).length>d;if(!h){u.addClass("balloon-layout-inner--loading");var p=setInterval(function(){u.css({height:u.find("ymaps").css("height")})},100)}}return e.post("/js.php",o.extend({},a.getQuery(),{area:"service",action:"tooltip",service_ids:[l.id],gallery:a.options.balloon_gallery?1:0}),function(t){n.is_phone?e("#ymaps-balloon").html(t):(a.setBalloonContent(r,t),a.activationBalloon(r)),n.is_phone||(u.removeClass("balloon-layout-inner--loading"),setTimeout(function(){clearInterval(p),a.autoPanUpdate(a.getBalloon(r))},200))}),!1},u.prototype.balloonOpen=function(t,e){t.open(e)},u.prototype.hasDimensions=function(){var t=e(this.getMapElement()),o=t.width(),n=t.height();return!(!o||!n)},u.prototype.setConSizes=function(t,e){t&&(this.getMapElement().style.width=t),e&&(this.getMapElement().style.height=e)},u.prototype.getConParentDims=function(){var t=this.node.parent(),e=t.width(),o=t.height();return{width:e,height:o}},u.prototype.updateSize=function(t,e){if(this.map&&this.getMapElement()&&this.hasDimensions()){var o=this.getConParentDims(),n=this.map.getBounds();if(n[0]==n[2]||n[1]==n[3]||o.width!=this.current_width||o.height!=this.current_height){this.current_height=o.height,this.current_width=o.width;var i=this.map.getCenter();this.setConSizes(t,e),this.fitToViewport(),this.setCenter(i)}}},u.prototype.updateSizeNotCenter=function(t,e){this.map&&this.getMapElement()&&this.hasDimensions()&&(this.setConSizes(t,e),this.fitToViewport({preservePixelPosition:!0}))},u.prototype.createClusterer=function(){var t=this,o={clusterDisableClickZoom:!0,clusterOpenBalloonOnClick:!1,gridSize:l,zIndex:2,zIndexActive:3,clusterIconContentLayout:ymaps.templateLayoutFactory.createClass(d),clusterBalloonContentLayout:ymaps.templateLayoutFactory.createClass("{{properties.balloonContent|default:properties.hintContent|raw}}")};this.clusterer=new ymaps.Clusterer(o),t.options.balloonLayout&&t.setTemplateLayout(this.clusterer,t.options.balloonLayout),t.addEvents(t.getBalloon(this.clusterer),t.events.open,function(o){t.setClusterPreset(t.getData(o,"cluster"),"z#cluster-dot"),i(function(){var o=e(t.getBalloonElement(t.getBalloon(t.clusterer))),n=o.find(".balloon-scrolled-block:first");n.data("wheelPrevented")||n.mousewheelLimited().data("wheelPrevented",!0);var i=o.find("ymaps").filter(function(){return!e(this).data("wheelPrevented")});i.mousewheelPreventOnly().data("wheelPrevented",!0)})}),t.addEvents(t.getBalloon(this.clusterer),"close",function(e){t.setClusterPreset(t.getData(e,"cluster"),"z#cluster")}),t.addEvents(t.getBalloon(this.clusterer),t.events.autopanbegin,function(){t.bounds_change_blocks++}),t.addEvents(t.getBalloon(this.clusterer),t.events.autopanend,function(){t.bounds_change_blocks--}),this.clusterer.createCluster=function(e,o){var n=ymaps.Clusterer.prototype.createCluster.apply(this,arguments);t.setClusterPreset(n,"z#cluster");var i=[];for(var a in o)i.push(t.getPlacemarkData(o[a],"hintContent"));return t.setPlacemarkData(n,"hintContent",i.join("<br />")),t.addEvents(n,"click",function(e){t.trigger("z-cluster-click",e),t.showClusterBalloon(n)}),t.addEvents(n,[t.events.mouseenter,t.events.mouseleave],function(e){"z#cluster-dot"!=n.options.get("preset")&&t.highlightCluster(n,t.getData(e,"type")==t.events.mouseenter)}),n},t.addObjectOnMap(this.clusterer)},u.prototype.createMap=function(t){var i=this,a={},r={};if(!t)throw Error("no bounds");a=t[0]&&t[1]?u.utilGetCenterAndZoom(t,[this.node.width(),this.node.height()]):o.clone(t),a.zoom>17&&(a.zoom=17),a.behaviors=["drag","dblClickZoom","multiTouch"],a.controls=[],r.autoFitToViewport="none",this.map=new ymaps.Map(this.node[0],a,r),this.options.clusterer&&this.createClusterer(),n.is_mobile&&i.removeControls(["zoomControl"]),i.options.controls.apply(i),this.options.placemark_user&&(this.updateProfile_binded=function(t,e){var o=!1;if(i.profilePlacemark){o=i.getBalloon(i.profilePlacemark)&&i.isBalloonOpen(i.getBalloon(i.profilePlacemark));try{i.removeObjectFromMap(i.profilePlacemark)}catch(t){}i.profilePlacemark=null}window.Global.user.has_coords&&(i.addProfile(),(e||o)&&i.showProfile(e,o))},e(window).on("z-location-changed",this.updateProfile_binded),this.updateProfile_binded(!1)),this.bounds_change_blocks=0,i.addEvents(this.map,"boundschange",function(){0==i.bounds_change_blocks&&i.trigger("z-boundschange")}),i.addEvents(this.map,"wheel",function(){i.map&&!i.wheelEnabled||i.trigger("z-map-zoom")}),this.pushOnReady(function(){var t=i.getConParentDims();i.current_width=t.width,i.current_height=t.height,i.onShowHook()})},u.prototype.showProfile=function(t,e){var o=this;return!t&&o.profilePlacemark&&o.getBalloon(o.profilePlacemark)&&e?(o.current_balloon&&o.current_balloon!=o.profilePlacemark.balloon&&o.balloonClose(o.current_balloon),void o.balloonOpen(o.getBalloon(o.profilePlacemark),o.map.getCenter())):void o.mapMoveToPlacemark(this.profilePlacemark,t,function(){e&&o.balloonOpen(o.getBalloon(o.profilePlacemark),o.map.getCenter()),o.trigger("z-boundschange")})},u.prototype.close=function(){e(window).off("z-location-changed",this.updateProfile_binded)},u.prototype.loadObjects=function(t,o){var n=function(t){var e={};return e.top=t[0][0],e.left=t[0][1],e.bottom=t[1][0],e.right=t[1][1],e},i=o&&this.map?this.map.getBounds():[[-1e3,-1e3],[1e3,1e3]],a=n(i);e.post(this.options.map_url,a,t)},u.prototype.updateBounds=function(t,e,o){if(o=o||15,t.length)this.setBounds(u.calculatePartialBoundsByObjects(t,this.options.bounds_adjustment_mode));else if("undefined"!=typeof e&&e){
var n=ymaps.util.bounds.getCenterAndZoom(e,[this.node.width(),this.node.height()]);n.zoom=n.zoom>=o?o:n.zoom,this.bounds_change_blocks++,this.map.setCenter(this.translateCenter(n.center,n.zoom),n.zoom),this.bounds_change_blocks--}else{var i=this.map.getZoom()-3;this.bounds_change_blocks++,this.map.setZoom(i<=9?9:i),this.bounds_change_blocks--}},u.prototype.update=function(t){if(!this.options.items_dynamic)throw new Error("cannot reload");if(this.is_ready){var e=this;e.loadObjects(function(o){e.updateObjects(o.items),t&&e.options.center_on_items&&e.updateBounds(o.items,o.bounds)},!1)}},u.prototype.addProfile=function(){var t=this,o=t.createPlacemark([1*window.Global.user.lat,1*window.Global.user.lon],{balloonContent:'Если местоположение определено некорректно, кликните на <a href="#" class="js-location-auto">переопределить</a> или задайте его вручную, переместив эту метку на карте.',hintContent:"Это вы. Кликните, если вы в другом месте",balloon:!0},{draggable:!0});t.setPlacemarkPreset(o,"z#profile"),t.addEvents(o,t.events.dragend,function(n){var i=t.getCoordinates(o);e(window).trigger("z-location-set",[i,null,!1])}),t.addEvents(o,t.events.balloonopen,function(o){var n=t.getData(o,"target"),i=t.getBalloon(n),a=e(t.getBalloonElement(i));t.node.removeClass("ymballooned"),t.switchCurrentBalloon(i),a.find(".js-location-auto").on("click",function(t){t.preventDefault(),e(window).trigger("z-location-auto",[i])}),a.find(".js-location-manual").on("click",function(o){o.preventDefault(),e(window).trigger("z-location-manual"),t.balloonClose(i)})}),t.addObjectOnMap(o),this.profilePlacemark=o},u.prototype.runLocationAuto=function(t){var o=this;e(window).trigger("z-location-auto",[null,function(e){o.pushOnReady(function(){e&&(o.profilePlacemark||o.addProfile(),o.showProfile(null,!0)),t&&t(e)})}])},u.prototype.getPreset=function(){return this.is_single?"z#singlemarker":"z#marker"},u.prototype.updateObjects=function(t){var e={},i={},a=this;a.is_single=1==t.length;for(var r in this.placemarks)r!=this.placemark_clicked?i[r]=this.placemarks[r]:e[r]=this.placemarks[r];this.placemarks=e;for(var s=[],l=[],r=t.length-1;r>=0;r--){var c=t[r];if((!c.id||c.id!=this.placemark_clicked)&&c.lonlat){var u=this.getPreset();if(i[c.id]&&"object"==typeof i[c.id]){var d=i[c.id];delete i[c.id],this.placemarks[c.id]=d,this.setPlacemarkPreset(d,u),a.setPlacemarkData(d,"itemData",c)}else{var h={};n.is_phone||(h={balloonAutoPan:!0,balloonAutoPanMargin:this.options.balloonAutoPanMargins,balloonMaxHeight:this.options.balloonMaxHeight});var p=void 0;this.options.balloon&&(p=c.name),this.options.balloon_loader&&(p='<div class="balloon-layout-inner-loader"></div>');var d=a.createPlacemark([c.lonlat[1],c.lonlat[0]],{balloonContent:p,hintContent:c.name,itemData:c,balloon:!(!this.options.balloon||n.is_phone)},h);a.options.balloonLayout&&a.setTemplateLayout(d,a.options.balloonLayout),this.setPlacemarkPreset(d,u),a.setPlacemarkData(d,"itemData",c),this.options.balloon&&(n.is_phone?(a.setData(d.options,"openBalloonOnClick",!1),a.addEvents(d,"click",this.onBalloon_binded)):(a.addEvents(d,a.events.balloonopen,this.onBalloon_binded),a.addEvents(d,a.events.balloonopen,function(t){a.setPlacemarkPreset(a.getData(t,"target"),"z#dot")}),a.addEvents(d,a.events.balloonclose,function(t){a.onBalloon_close(t);var e=a.getData(t,"target");a.setPlacemarkPreset(e,a.getPreset(a.getPlacemarkData(e,"itemData")))})),a.addEvents(a.getBalloon(d),a.events.autopanbegin,function(){a.bounds_change_blocks++}),a.addEvents(a.getBalloon(d),a.events.autopanend,function(){a.bounds_change_blocks--})),this.options.feedback&&a.addEvents(d,[a.events.mouseenter,a.events.mouseleave],this.onHighlight),this.options.clusterer?s.push(d):a.addObjectOnMap(d),this.placemarks[c.id]=d,function(t){a.addEvents(d,"click",function(e){a.trigger("z-placemark-click",e,t),o.isFunction(a.onPlacemarkClick)&&a.onPlacemarkClick(t)})}(c)}}}if(this.options.clusterer){for(var r in i)l.push(i[r]);a.removeCluster(l),a.addCluster(s)}else for(var r in i)a.removeObjectFromMap(i[r])},u.prototype.getBounds=function(){var t=this.map?this.map.getBounds():null;return t?[t[0][1],t[0][0],t[1][1],t[1][0]]:null},u.prototype.setPlacemarkPreset=function(t,e){var o=this,n=t.options;o.getData(n,"preset")!=e&&(o.setPlacemarkIcon(t,e),o.setData(n,"preset0",e),o.setData(n,"preset1",e+"-hover"))},u.prototype.setPlacemarkIcon=function(t,e){this.setData(t.options,"preset",e)},u.prototype.setClusterPreset=function(t,e){var o=this,n=t.options;o.getData(n,"preset")!=e&&(o.setData(n,"clusterIcons",ymaps.option.presetStorage.get(e)),o.setData(n,"preset0",ymaps.option.presetStorage.get(e)),o.setData(n,"preset1",ymaps.option.presetStorage.get(e+"-hover")),o.setData(n,"preset",e))},u.calculateBoundsByObjects=function(t){for(var e=1e4,o=-1e4,n=1e4,i=-1e4,a=0;a<t.length;a++)t[a].lonlat&&(e=Math.min(e,t[a].lonlat[0]),o=Math.max(o,t[a].lonlat[0]),n=Math.min(n,t[a].lonlat[1]),i=Math.max(i,t[a].lonlat[1]));return[[n,e],[i,o]]},u.expandBounds=function(t,e){return[[t[0][0]-e,t[0][1]-e],[t[1][0]+e,t[1][1]+e]]};var p=function(t,e){for(var o=0,n=[0,0],i=0;i<t.length;i++){var a=t[i].lonlat;a&&a[1]>=e[0][0]&&a[1]<=e[1][0]&&a[0]>=e[0][1]&&a[0]<=e[1][1]&&(o++,n[0]+=a[1],n[1]+=a[0])}return[o,[n[0]/o,n[1]/o]]};return u.calculatePartialBoundsByObjects=function(t,e){if(0==t.length)return null;var o;o="precise"==e?t.length>150?.8:t.length>100?.9:t.length>50?.95:1:"flexible"==e?t.length>=50?.15:1:t.length>=50?.8:1;var n=u.calculateBoundsByObjects(t);if(1==o)return u.expandBounds(n,.003);for(var i=[(n[1][0]+n[0][0])/2,(n[1][1]+n[0][1])/2],a=[Math.abs(n[1][0]-n[0][0])/2,Math.abs(n[1][1]-n[0][1])/2],r=1,s=0;a[0]>0&&a[1]>0&&(r<.95*o||r>1.05*o)&&s<20;){a=r>1.05*o?[.8*a[0],.8*a[1]]:[a[0]/.9,a[1]/.9];var l=p(t,[[i[0]-a[0],i[1]-a[1]],[i[0]+a[0],i[1]+a[1]]]);r=l[0]/(1*t.length),l[0]&&(i=l[1]),s++}return[[i[0]-a[0],i[1]-a[1]],[i[0]+a[0],i[1]+a[1]]]},u.prototype.setBounds=function(t,e){if(!this.is_ready)throw new Error("map not ready");if(null==t)return!1;if(this.bounds_change_blocks++,e&&e.duration){var o=e.callback,n=this;e.callback=function(){o&&o(),n.bounds_change_blocks--},this.map.setBounds(t,e)}else this.map.setBounds(t,e),this.bounds_change_blocks--;return!0},u.prototype.setCenterAndZoom=function(t,e){return this.bounds_change_blocks++,this.map.setCenter(t,e),this.bounds_change_blocks--,!0},u.prototype.setCenter=function(t){this.map.setCenter(t)},u.prototype.highlightItem=function(t,e){var o=this,n=this.placemarks[t];if(n&&0!=o.getPlacemarkData(n,"itemData").type.indexOf("point")){if(e){if(this.prev_highlighted==t)return;this.prev_highlighted&&this.highlightItem(this.prev_highlighted,!1),this.prev_highlighted=t}else this.prev_highlighted==t&&(this.prev_highlighted=null);if(this.options.clusterer){var i=o.isCluster(n);i&&this.highlightCluster(o.getObjectCluster(n),e)}e?o.setPlacemarkIcon(n,o.getData(n.options,"preset1")):o.setPlacemarkIcon(n,o.getData(n.options,"preset0"))}},u.prototype.highlightCluster=function(t,e){t&&(e?t.options.set("clusterIcons",t.options.get("preset1")):t.options.set("clusterIcons",t.options.get("preset0")))},u.prototype.getZoom=function(){return this.map&&this.map.getZoom?this.map.getZoom():null},u.prototype.setZoom=function(t,e){return this.map&&this.map.setZoom?this.map.setZoom(t,e):null},u.prototype.getZoomRange=function(){return this.map&&this.map.zoomRange?this.map.zoomRange:null},u.prototype.getCenter=function(){return this.map&&this.map.getCenter?this.map.getCenter():null},u.prototype.toggleZoomControl=function(t){this.map&&this.map.controls&&(t?this.addControls(["zoomControl"]):this.removeControls(["zoomControl"]))},u.prototype.addControls=function(t){var e=this;o.each(t,function(t){e.map.controls.add(t)})},u.prototype.removeControls=function(t){var e=this;o.each(t,function(t){e.map.controls.remove(t)})},u.prototype.initByPoints=function(t){var e=this;t.length&&(e.pushOnReady(function(){e.updateObjects(t)}),e.resume(function(){return u.calculatePartialBoundsByObjects(t,e.options.bounds_adjustment_mode)}))},u.prototype.addRoute=function(t,e){if(!e){if(!window.Global.user.has_coords)return;e=[window.Global.user.lat,window.Global.user.lon]}var o=this;ymaps.load(["route"],function(){ymaps.route([e,t],{mapStateAutoApply:!1}).then(function(t){var e=t.getWayPoints();e.each(function(t){t.options.set("visible",!1)}),o.addObjectOnMap(t)},function(t){})})},u.prototype.setQuery=function(t){this.query=t},u.prototype.getQuery=function(){return this.query},u.utilGetCenterAndZoom=function(t,e){return ymaps.util.bounds.getCenterAndZoom(t,e)},u.toPixelsMercator=function(t,e){return ymaps.projection.wgs84Mercator.toGlobalPixels(t,e)},u.fromPixelsMercator=function(t,e){return ymaps.projection.wgs84Mercator.fromGlobalPixels(t,e)},u.prototype.mapMoveToPlacemark=function(t,e,o){var n=this,i=new ymaps.map.action.Single({center:this.translateCenter(n.getCoordinates(t),e||12),zoom:e||12,duration:750,timingFunction:"ease-in",checkZoomRange:!1,callback:o});n.map.action.execute(i)},u.prototype.events={mouseenter:"mouseenter",mouseleave:"mouseleave",balloonopen:"balloonopen",balloonclose:"balloonclose",autopanbegin:"autopanbegin",autopanend:"autopanend",open:"open",dragend:"dragend"},u.prototype.getData=function(t,e){return t.get(e)},u.prototype.setData=function(t,e,o){return t.set(e,o)},u.prototype.getPlacemarkData=function(t,e){return t.properties.get(e)},u.prototype.setPlacemarkData=function(t,e,o){return t.properties.set(e,o)},u.prototype.addObjectOnMap=function(t){this.map.geoObjects.add(t)},u.prototype.removeObjectFromMap=function(t){this.map.geoObjects.remove(t)},u.prototype.getBalloonContent=function(t){return t.properties.get("balloonContent")},u.prototype.setBalloonContent=function(t,e){t.properties.set("balloonContent",e)},u.prototype.addEvents=function(t,e,o){t.events.add(e,o)},u.prototype.fireEvent=function(t,e){t.events.fire(e)},u.prototype.getBalloon=function(t){return t.balloon},u.prototype.balloonClose=function(t){t.close()},u.prototype.isBalloonOpen=function(t){return t.isOpen()},u.prototype.getOverlay=function(t){return t.getOverlaySync()},u.prototype.getBalloonElement=function(t){return t.getOverlaySync().getBalloonElement()},u.prototype.autoPanUpdate=function(t){t.autoPan()},u.prototype.createPlacemark=function(t,e,o){return new ymaps.Placemark(t,e,o)},u.prototype.setTemplateLayout=function(t,e){var o=ymaps.layout.storage.get(e);t.options.set("balloonLayout",o)},u.prototype.behaviorsEnabled=function(t){this.map.behaviors.enable(t)},u.prototype.behaviorsDisabled=function(t){this.map.behaviors.disable(t)},u.prototype.getCoordinates=function(t){return t.geometry.getCoordinates()},u.prototype.mapDestroy=function(){this.map&&this.map.destroy()},u.prototype.addCluster=function(t){this.clusterer.add(t)},u.prototype.removeCluster=function(t){this.clusterer.remove(t)},u.prototype.isCluster=function(t){return this.clusterer.getObjectState(t).isClustered},u.prototype.getObjectCluster=function(t){return this.clusterer.getObjectState(t).cluster},u.prototype.getMapElement=function(){return this.map.container&&this.map.container.getMapElement()},u.prototype.fitToViewport=function(t){this.map.container.fitToViewport(t&&t.preservePixelPosition||!1)},require(["jquery"],s),u}),define("js2/StatHelper",["jquery"],function(t){var e,o;return window.ga&&ga(function(t){void 0!==t&&(e=t.get("clientId"),o=t.get("trackingId"))}),function(n,i){var a=i.stat_label||null,r=i.object_type||"organization",s=i.object_id||null;t(window).trigger("track-event",[r,n,a]),"show_phone"==n&&i.isabctest&&t(window).trigger("track-event",["abc_test_snippet","show_phone"]),s&&require(["js2/StatService"],function(t){t({action_type:n,object_type:r,label:a,clientId:e,trackingId:o,sourceType:i.source_type,trackTag:i.track_tag,orgId:i.org_id},function(t){t&&t(s)})})}}),define("js2/jquery.layer",["jquery","./Observable","underscore","js2/env"],function(t,e,o,n){window.jquery_layer_opts=o.extend({css:null,q:[]},window.jquery_layer_opts||{}),window.jquery_layer_opts.q&&setTimeout(function(){var t=window.jquery_layer_opts.q;window.jquery_layer_opts.q=[],o.each(t,function(t){window.create_layer.apply(null,t)})},0);var i=function(e){if(!window.jquery_layer_opts.css)return void e();var o=document.createElement("div");o.id="layerLoad",document.body.appendChild(o),t("head").append(window.jquery_layer_opts.css);var n=0,i=100,a=function(){n>i||"hidden"==t(o).css("visibility")?(window.jquery_layer_opts.css=null,e()):setTimeout(function(){n++,a()},50)};a()};window.create_layer=function(t,e){return i(function(){a.instance(t,e)}),!0};var a=window.LayerClass=function(n,i){if(t("#layer_"+n).length)throw"layer "+n+" already exists";this.name=n,this.id="layer_"+this.name,this.node=null,this.settings=i||{},a.items.push(this),t.extend(this,window.LayerClass.defaultSettings,this.settings),o.extend(this,new e),this.init()};window.LayerClass.defaultSettings={width:"auto",height:"auto",created:!1,parameters:{},url:"/layer/%name%/",tpl:null,usecache:!0,is_mobile:n.is_mobile,offset:n.is_phone?0:5,padding:0,wrapper:"#wrapper",closeable:!0,closeByScreenlocker:!0,popstate:!1,changeViewport:!0,zIndex:10999,beforeShow:function(){},afterShow:function(){},beforeClose:function(t){},afterClose:function(t){}},a.zIndex=10999,a.cache={},a.items=[],a.create=function(t,e){return new a(t,e)},a.instance=function(t,e){var o=a.find(t);return o||(o=a.create(t,e)),o},a.find=function(t){for(var e=0;e<a.items.length;e++)if(a.items[e].name==t)return a.items[e]},a.findLast=function(){return a.items.length?a.items[a.items.length-1]:null},a.remove=function(t){var e=a.items;a.items=[];for(var o=0;o<e.length;o++)e[o]!=t&&a.items.push(e[o])},a.forEach=function(t){for(var e=a.items,o=0;o<e.length;o++)t(e[o])},a.prototype.init=function(){this.zIndex=a.zIndex++,window.screenLocker.show();var e=this.name+"_"+(this.url||"");if(this.parameters)for(var o in this.parameters)e+="_"+this.parameters[o];if(function(e){function o(e,o){var a=t(window).width(),r=t(window).height(),s=e||520,l=o||520,c=a/(s+10),u=r/(l+10),d=i.replace(/(maximum-scale=)([\d\.]+)/,"$1"+Math.min(c,u,1.5));return n.attr("content",d),d}if(e.on("afterShow",function(){t(window).trigger("layer-after-show",[e,e.scroll_div])}),e.on("beforeClose",function(){t(window).trigger("layer-before-close",[e,e.scroll_div])}),e.on("afterClose",function(){t(window).trigger("layer-after-close",[e,e.scroll_div])}),e.is_mobile){var n=t("[name=viewport]"),i=n.attr("content"),a=0;e.on("beforeShow",function(){a=t(window).scrollTop()}),e.on("afterShow",function(){this.changeViewport&&o(e.wrap_div.outerWidth(),e.wrap_div.outerHeight()),t(document.body).addClass("layer-exclusivity"),t(e.wrapper).addClass("get-out")}),e.on("beforeClose",function(){n.attr("content",i),t(e.wrapper).removeClass("get-out"),t(document.body).removeClass("layer-exclusivity")}),e.on("afterClose",function(){t(window).scrollTop(a)})}}(this),this.beforeShow(this),this.trigger("beforeShow"),this.popstate&&window.history.pushState({layer:this.name,settings:JSON.stringify(this.settings)},null,window.location.href),this.tpl)this.show();else if("undefined"!=typeof a.cache[e])this.tpl=a.cache[e],this.show();else if(t("#layer_"+this.name+"_tpl").length)this.tpl=t("#layer_"+this.name+"_tpl"),this.created||(this.tpl=this.tpl.html()),this.show();else{var n=this;t.get(this.url.replace("%name%",this.name),this.parameters,function(o){o=t.trim(o),n.usecache&&(a.cache[e]=o),n.tpl=o,n.show()})}},a.prototype.setCloseable=function(t){var e=!!t;this.closeable=e,e?this.$closeLayer.show():this.$closeLayer.hide()},a.prototype.close=function(e){function o(){n.scroll_div.remove(),n.afterClose(e),n.trigger("afterClose",[e]),n.closed=!0,t(window).trigger("height")}if(!this.con)return this;if(this.closed)return this;if(this.beforeClose(e)===!1)return this;this.trigger("beforeClose",[e]);var n=this;return this.con.hide(),n.change_url&&n.url&&n.previous_url&&(history.replaceState(null,null,n.previous_url),n.previous_url=null),o(),a.remove(this),a.items.length||(t("body").removeClass("body-open-layer"),t(this.wrapper).css("marginTop",""),t("html, body").css("overflow",""),window.scrollTo(0,this.scrollTop)),this.popstate&&t(window).off("popstate.layer"+this.name),window.screenLocker.hide(),this},a.prototype.setFullSpace=function(){this.con.css({left:"",top:""}),this.con.addClass("layer-fullspace-mode")},a.prototype.setPosition=function(){if(!this.con)return!1;if(this.fullscreen_enabled)return void this.setFullSpace();var e,o=t(window).width(),n=t(window).height(),i=this.wrap_div.width(),a=this.wrap_div.height(),r="fixed";e=i+2*this.offset<o?(document.documentElement.offsetWidth-i)/2:this.offset;var s=(n-a)/2;a+2*this.offset>n&&(r="absolute",s=1*t(window).scrollTop()+this.offset);var l={position:r,left:e+"px",top:s+"px"},c=o-2*this.offset-2*this.padding;l["max-width"]=c,this.padding&&i+2*this.offset+2*this.padding>o&&(l.left=this.offset+this.padding),this.con[a<n?"addClass":"removeClass"]("layer-less-than"),this.con[a<n?"removeClass":"addClass"]("layer-more-than"),this.con.css(l)};var r=t('<div class="layer-content-scroll"><!-- --></div>'),s=t('<div class="layer-container hidden"><!-- --></div>'),l=t("<div class='layer-content-wrap'></div>");a.prototype.useFullScreen=function(){this.fullscreen_enabled=!0,this.setFullSpace()},a.prototype.show=function(){var e=this,o=t(this.tpl).filter("*");o.filter("[data-layer-offset]").length&&(this.offset=o.filter("[data-layer-offset]").data("layerOffset")),o.filter("[data-layer-padding]").length&&(this.padding=o.filter("[data-layer-padding]").data("layerPadding")),this.created?(this.scroll_div=o.find(".layer-content-scroll").css({zIndex:this.zIndex}),this.con=o.find(".layer-container"),this.wrap_div=o.find(".layer-content-wrap").attr("id",this.id),this.node=this.wrap_div,o.attr("style","")):(this.scroll_div=r.clone().css({position:"fixed",top:0,left:0,width:"100%",height:"100%",overflow:"auto",zIndex:this.zIndex}).appendTo(document.body),this.con=s.clone().appendTo(this.scroll_div),this.wrap_div=l.clone().attr("id",this.id).appendTo(this.con),this.node=this.wrap_div,this.con.css({width:"auto"==this.width?"":this.width+"px",height:"auto"==this.height?"":this.height+"px",position:"fixed","z-index":this.zIndex}),o.addClass("layer-content"),this.wrap_div.append(o),this.con.removeClass("hidden")),this.scroll_div.on("click",function(o){var n=t(o.target);return n.closest(".layer-close").length?(e.closeable&&e.close(),!1):n.closest(e.con).length?void 0:(e.closeByScreenlocker&&e.closeable&&e.close(),!1)}),this.scroll_div.on("scroll",function(){t(window).trigger("layer-scroll",[e])}),this.popstate&&t(window).on("popstate.layer"+this.name,function(t){e.closeable&&e.close()}),1==a.items.length&&(t("body").addClass("body-open-layer"),this.scrollTop=t(window).scrollTop(),t(this.wrapper).css("marginTop",-this.scrollTop+"px"),t("body").css("overflow","hidden"),t("html").css("overflow-y","scroll")),this.setPosition(),this.content_node=o,this.con.show(),e.change_url&&e.url&&(e.previous_url=window.location.href,history.replaceState(null,null,e.url)),this.afterShow(this),this.trigger("afterShow"),this.$closeLayer=t(".layer-close",this.wrap_div),this.setCloseable(this.closeable),this.closed=!1},window.screenLocker={counter:0,node:null,show:function(){if(this.node){this.counter++,1==this.counter&&this.node.show();var e=a.findLast();this.node.css("z-index",e.zIndex)}else this.node=t("#popupLayerScreenLocker"),this.node.length||(this.node=t('<div id="popupLayerScreenLocker"></div>'),t("body").append(this.node)),this.show()},hide:function(){if(0!==this.counter)if(this.counter--,0===this.counter)this.node.hide();else{var t=a.findLast();this.node.css("z-index",t.zIndex)}}},t(window).on("resize.layer",function(t){a.forEach(function(t){t.setPosition()})}),t(document).on("keydown.layer",function(t){var e=a.findLast();if(e)switch(t.keyCode){case 27:e.closeable&&e.close()}})}),define("js2/ZATimer",["jquery","underscore","js2/jquery.layer"],function(t,e,o){"use strict";function n(t,e){var o=t.data("displayEventInfo")||{},n=(e.ev_action||"")+(e.ev_category||"");return o[n]=o[n]||{},o[n].last_sent_ts=o[n].last_sent_ts||null,o[n].timerId=o[n].timerId||null,t.data("displayEventInfo",o),o[n]}function i(t){var e=(t.ev_action||"")+(t.ev_category||"");return k[e]=k[e]||[],k[e]}function a(t,e,o){var a=n(t,e);return!(!a.last_sent_ts||!o.send_once)||!(!o.send_once_by_key||i(e).indexOf(o.send_once_by_key)===-1)}function r(e){return t.contains(document.documentElement,e[0])}function s(t,e,o){var s=n(t,e);a(t,e,o)||r(t)&&(window.za(u(e,[t])),s.last_sent_ts=+new Date/1e3,o.send_once_by_key&&i(e).push(o.send_once_by_key))}function l(t,e){var o=n(t,e);o.timerId&&(clearTimeout(o.timerId),o.timerId=null)}function c(o,i,c){function u(t,o,n){return n.interval>0?setTimeout(e.bind(s,window,t,o,n),1e3*n.interval):(s(t,o,n),null)}var h=d(o,i,c);o=h[0],i=h[1],c=h[2];var p=n(o,i);if(a(o,i,c))return void l(o,i);for(var f=LayerClass.items.length;f--;)if(!LayerClass.items[f].closed&&!o.closest(LayerClass.items[f].scroll_div).length)return void l(o,i);if(!r(o))return void l(o,i);if(!document.hasFocus())return void l(o,i);var m=o.closest(".service-action-item"),g=m.length>0?m:o,y=window.is_mobile?t("#header").find(".header-container"):t("#serviceNavPanel"),_=y.length?y.outerHeight():0,w=t(window).height(),b=t(window).scrollTop(),C=c.visible_percent,k=g.offset(),x=k.top,z=g.outerWidth(),P=g.height(),j=g[0].getBoundingClientRect(),S=Math.max(b+_,x),B=Math.min(x+P,b+w),I=Math.max(0,(B-S)/P),O=document.elementFromPoint(j.left+z*C/2,j.top+P*C/2),E=t(O).closest(g)[0]===g[0];return v&&t("<div>").css({width:4,height:4,background:"#0f0",left:j.x+z*C/2,top:j.y+P*C/2,position:"fixed",zIndex:99999,borderRadius:2}).appendTo(document.body),I<C||!E?void l(o,i):void(p.timerId||(p.timerId=u(o,i,c)))}function u(t,o){var n=e.clone(t);return e.each(n,function(t,i){e.isFunction(t)&&(n[i]=t.apply(n,o))}),n}function d(o,n,i){var a=t(o).data("za")||{},r=e.clone(n)||{},s=e.clone(i)||{};return s.send_once=void 0===a.send_once||a.send_once,a.send_once_by_key&&e.extend(s,{send_once:!0,send_once_by_key:a.send_once_by_key}),a.visibility_block_selector&&e.extend(s,{visibility_block_selector:a.visibility_block_selector}),e.extend(r,a.data),[t(o),r,s]}function h(e,o){return function(){var n=t(this).data("za");if(!n)return!1;var i=[];e.eventOpts&&e.eventOpts.ev_action&&(i=e.eventOpts.ev_action.split("_"));for(var a=!0;i.length;){if("track_"+i.join("_")in n){a=n["track_"+i.join("_")];break}i.pop()}a&&o.call(this,e)}}function p(e,o){o=o||document.documentElement;for(var n=0,i=C.length;n<i;++n)for(var a=t(o).find(C[n].selector),r=h(C[n],e),s=0,l=a.length;s<l;++s)r.call(a[s])}function f(t){return e.map(t.split(" "),function(t){return t+"."+g}).join(" ")}function m(t,e){function o(){t(),i||(n=setTimeout(o,e))}var n,i=!1;return setTimeout(o,e),{clear:function(){clearTimeout(n),i=!0}}}var g="zaTimer",v=!1,y=3,_=30,w=window.is_mobile?1:.7,b=1,C=[],k={};t(window).off("."+g),t(window).on(f("resize scroll"),e.rafThrottle(function(e){p(function(e){c(t(this),e.eventOpts,e.trackingOpts)})},{leading:!1})),t(window).on(f(["layer-after-close","balloon-after-close","ymap-balloon-close"].join(" ")),function(e,o,n){p(function(e){var o=d(t(this),e.eventOpts,e.trackingOpts),n=o[0],i=o[1];o[2];l(n,i)},t(n))}),t(window).on(f(["layer-after-show layer-after-close layer-scroll","balloon-after-show balloon-after-close","ymap-balloon-close","height"].join(" ")),function(e){p(function(e){c(t(this),e.eventOpts,e.trackingOpts)})}),t(window).data(g+"MainIntervalId")&&t(window).data(g+"MainIntervalId").clear(),t(window).data(g+"MainIntervalId",m(function(){p(function(e){c(t(this),e.eventOpts,e.trackingOpts)})},1e3));var x={DISPLAY_INTERVAL:y,DISPLAY_LONG_INTERVAL:_,VISIBLE_PERCENT:w,VISIBLE_PERCENT_LONG:b,track:function(t,e,o){var n={selector:t,eventOpts:e,trackingOpts:o};C.push(n)},trigger:function(e,o,n){h({eventOpts:o,trackingOpts:n},function(e){var o=d(t(this),e.eventOpts,e.trackingOpts),n=o[0],i=o[1],a=o[2];s(n,i,a)}).call(e)},untrack:function(e){for(var o=0;C[o];){var n=C[o];e instanceof t&&n.selector instanceof t&&n.selector.is(e)||e===n.selector?C.splice(o,1):++o}}};return x}),define("js2/phoneController",["jquery","js2/StatHelper","js2/ZATimer"],function(t,e,o){var n=!1;return function(i){t(document).off("touchstart.phone click.phone").on("touchstart.phone click.phone",".js-phone",function(a){var r=t(this),s=r.closest(".js-phone-holder"),l=r.data("json"),c=r.data("za");"object"!=typeof l&&(l=t.parseJSON(l)),i?n||(n=!0,setTimeout(function(){n=!1},300),e("call_phone",l),c&&(o.trigger(r,{ev_action:"display"},{send_once:!0}),o.trigger(r,{ev_action:"open"},{send_once:!0}))):(a.preventDefault(),r.hasClass("phone-hidden")&&(s.length?t(".js-phone",s).each(function(){var e=t(this);e.hasClass("phone-hidden")&&(t(".js-phone-number",e).text(e.data("number")),e.removeClass("phone-hidden").addClass("phone-showed"))}):(t(".js-phone-number",r).text(r.data("number")),r.removeClass("phone-hidden").addClass("phone-showed")),t(window).trigger("z-show-phone height"),e("show_phone",l),c&&(o.trigger(r,{ev_action:"display"},{send_once:!0}),o.trigger(r,{ev_action:"open"},{send_once:!0}))))}),i&&t(".js-phone").addClass("callto"),o.untrack(".js-phone[data-za]"),o.track(".js-phone[data-za]",{ev_action:"display"},{interval:o.DISPLAY_INTERVAL,visible_percent:o.VISIBLE_PERCENT}),o.track(".js-phone[data-za]",{ev_action:"display_long"},{interval:o.DISPLAY_LONG_INTERVAL,visible_percent:o.VISIBLE_PERCENT_LONG})}}),define("js2/Cookie",[],function(){var t={};return t.set=function(t,e,o,n,i,a){if(!t||!e)return!1;var r=t+"="+encodeURIComponent(e),s=o?new Date((new Date).getTime()+1e3*o).toGMTString():0;return r+="; path="+(n||"/"),r+="; expires="+s,i&&(r+="; domain="+i),a&&(r+="; secure"),document.cookie=r,!0},t.get=function(t){var e="(?:; )?"+t+"=([^;]*);?",o=new RegExp(e);return!!o.test(document.cookie)&&decodeURIComponent(RegExp.$1)},t.remove=function(t,e,o){return this.set(t,1,-1,e,o),!0},t}),define("js/misc",["jquery"],function(t){function e(){var e=t(".bgSmartImage");e.each(function(){var e=t(this).data("ratio")||1.7777,o=t(window).width()/t(window).height(),n={top:0,left:0,width:"auto",height:"auto"};e<o?(n.top=.5*-(o/e-1)*t(window).height()+"px",n.width=t(window).width()):(n.left=.5*(o-e)*t(window).height()+"px",n.height=t(window).height()),t(this).css(n)}).show()}return t(window).on("resize.bg",function(){e()}),t(function(){e()}),function(){}}),require(["js2/ZMap3","js2/phoneController"],function(){}),define("js/application",["jquery","underscore","js2/Cookie","js/misc","js2/jquery.layer"],function(t,e,o){t(document).on("click",".js-layer",function(o){o.preventDefault();var n=t(this).data("layer"),i=["pages"];return LayerClass.forEach(function(t){t.close()}),"offer"==n?void create_layer(n,{parameters:t(this).data("params")||{},offset:10}):void create_layer(n,{url:t(this).attr("href"),usecache:e.indexOf(i,n)==-1,parameters:t(this).data("params")||{},offset:10})}),t(document).on("click",".js-landing-price",function(e){e.preventDefault(),t(this).toggleClass("landing-price-full")}),t(window).on("z-show-phone",function(){o.set("show_phone",1,3600)}),jqready(function(){function e(){var e=t(".sidebar"),o=(t(".maincontainer"),t(".main-content-box",o));if(e.length&&o.length){var n=e.outerHeight(!0),i=o.height(),a=o.position().top;o[n-a<i?"addClass":"removeClass"]("content-longest").css({"min-height":n-a})}}function o(){var e=t('a[href="#info"]'),o=t("#info");if(e.length&&o.length){var n=t("html, body");e.on("click",function(t){t.preventDefault(),n.animate({scrollTop:o.offset().top},"slow")})}}e(),o()})}),define("js/landingScrollAnimation",["jquery"],function(t){function e(){var e=t(window).scrollTop();l.hasClass("landing-header-small")?d.toggleClass("landing-top-menu-fixed",a<=e):(c.addClass("fixed"),c.css("bottom",Math.min(n-k,e*x)+"px"),u.css("max-height",e+n-Math.min(n-k,e*x)+"px"),p.css("opacity",(n-e*x)/n),n<=2.5*e?(d.css("opacity",""),d.addClass("landing-top-menu-fixed")):(d.css("opacity",(n-e*x)/n),d.removeClass("landing-top-menu-fixed")));var o=s(r("transform"),e>=.75*n?-(e-.75*n)/2:0);if(h.css(o),h.css({opacity:""+(e>=.75*n?1-(e-.75*n)/n:1)}),e+n>g&&e<g+v){var f=1-(g+v-e)/(n+v);m.each(function(e,o){t(o).css("left",y*e-w*f)})}var _=1-(i-e-n)/(n/3);C.css("display",_<0?"none":"block"),b.css("top",-200*_+"%"),C.css("opacity",_)}function o(){i=t(document).height(),n=t(window).height(),a=l.height(),e()}var n,i,a,r=function(){var t=["","Webkit","Moz","ms","O"],e=document.createElement("div"),o={};return function(n){if(!_.has(o,n)){o[n]=null;for(var i=0,a=t.length;i<a;++i){var r=t[i]?t[i]+n.charAt(0).toUpperCase()+n.slice(1):n;if(null!=e.style[r]){o[n]=r;break}}}return o[n]}}(),s=function(t,e){var o={};return t?o[t]="translate(0,"+e+"px)":o.top=e+"px",o},l=t(".landing-header"),c=t(".js-header-shadow"),u=t(".landing-header-container"),d=t(".js-header-menu"),h=t(".js-header-gallery"),p=t(".landing-header-text"),f=t(".js-landing-photos"),m=f.find(".js-landing-photo"),g=f.offset().top,v=f.height(),y=m.length?m.first().width():0,w=.5*y,b=t(".js-landing-contacts"),C=t(".js-landing-contacts-shadow"),k=80,x=2.5;o(),t(window).on("resize",function(){o()}),t(window).on("scroll",_.rafThrottle(function(){e()})),t(window).on("layer-after-show",function(t){l.css("visibility","hidden"),c.css("visibility","hidden")}),t(window).on("layer-after-close",function(t){l.css("visibility",""),c.css("visibility","")})}),define("js/similarBoxes",["jquery"],function(t){return function(e){function o(){n.each(function(){var e=t(this),o=t(".wbox",e).height(""),n=t(".wborder .box-holder",e).height(""),i=e.height();o.each(function(){t(this).height(i)}),n.each(function(){var e=i-20;t(this).height(e),t(".overlay",this).css({"line-height":e+"px"})})})}var n=t(e);n.length&&(t(window).on("resize.lego",function(){o()}),o())}});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,o,n,i,a,r,s,l="",c=0;for(t=Base64._utf8_encode(t);c<t.length;)e=t.charCodeAt(c++),o=t.charCodeAt(c++),n=t.charCodeAt(c++),i=e>>2,a=(3&e)<<4|o>>4,r=(15&o)<<2|n>>6,s=63&n,isNaN(o)?r=s=64:isNaN(n)&&(s=64),l=l+this._keyStr.charAt(i)+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(s);return l},decode:function(t){var e,o,n,i,a,r,s,l="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)i=this._keyStr.indexOf(t.charAt(c++)),a=this._keyStr.indexOf(t.charAt(c++)),r=this._keyStr.indexOf(t.charAt(c++)),s=this._keyStr.indexOf(t.charAt(c++)),e=i<<2|a>>4,o=(15&a)<<4|r>>2,n=(3&r)<<6|s,l+=String.fromCharCode(e),64!=r&&(l+=String.fromCharCode(o)),64!=s&&(l+=String.fromCharCode(n));return l=Base64._utf8_decode(l)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",o=0;o<t.length;o++){var n=t.charCodeAt(o);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},_utf8_decode:function(t){for(var e="",o=0,n=0,i=0;o<t.length;)n=t.charCodeAt(o),n<128?(e+=String.fromCharCode(n),o++):n>191&&n<224?(i=t.charCodeAt(o+1),e+=String.fromCharCode((31&n)<<6|63&i),o+=2):(i=t.charCodeAt(o+1),c3=t.charCodeAt(o+2),e+=String.fromCharCode((15&n)<<12|(63&i)<<6|63&c3),o+=3);return e}};window.define&&define("js2/nobot/decode",{nb_get:nb_get,nb_write:nb_write}),"undefined"==typeof window.console&&(window.console={},window.console.log=function(){}),window.requestAnimationFrame=function(){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t;var e=+new Date;return t=function(t){var o=+new Date,n=Math.max(0,16-(o-e)),i=setTimeout(t,n);return e=o,i},function(){return t.apply(window,arguments)}}(),window.cancelAnimationFrame=function(){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;
return t?t:function(){window.clearTimeout.apply(window,arguments)}}(),_.mixin({rafThrottle:function(t,e,o){function n(){c=o.leading===!1?0:_.now(),a=null,l=t.apply(r,s),a||(r=s=null)}function i(){var i=_.now();c||o.leading!==!1||(c=i);var h=e-(i-c);return r=this,s=arguments,h<=0||h>e?(a&&(d(a),a=null),c=i,l=t.apply(r,s),a||(r=s=null)):a||o.trailing===!1||(a=u(n)),l}var a,r,s,l,c=0,u=window.requestAnimationFrame,d=window.cancelAnimationFrame;return o||(o={}),i.cancel=function(){d(a),c=0,a=r=s=null},i}}),"function"==typeof define&&define.amd&&define("js2/misc",[],function(){});